<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Quiz Game</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap');



        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
            cursor: block;
            font-family: 'Luckiest Guy', cursive, sans-serif;
            background: url("wp-1.svg") fixed center;
            background-size: cover;
        }

        #gameArea {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        #question {
            width: 100%;
            display: none;
            text-align: center;
            position: absolute;
            max-width: 90vw; /* Assicurati che il contenitore non superi il 90% della larghezza della viewport */
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4.5vw; /* Usa unità relative come vw per adattarsi dinamicamente */
            color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            text-shadow: 0 30px 15px rgba(0, 0, 0, 0.5);
            z-index: 10;
            animation: fadeInFromTop 1s ease-out forwards;
            box-sizing: border-box; /* Include padding e bordo nel calcolo della larghezza */
            
        }

        #square {
            display: inline-block;
            width: 30px;
            /* Larghezza del quadrato */
            height: 30px;
            /* Altezza del quadrato */
            margin-left: 10px;
            margin-right: 10px;
            border: 3.5px solid rgb(255, 255, 255);
            /* Bordo del quadrato */
            /* Puoi aggiungere altre proprietà per personalizzare il quadrato */
        }


        @keyframes zoomInOut {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        #countdown {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 150pt;
            color: white;
            z-index: 10;
            opacity: 1;
            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3));
            animation: fadeInFromTop 1s ease-out forwards, zoomInOut 1s infinite;
        }


        .button-82-pushable {
            position: absolute;
            left: 50%;
            transform: translate(-50%, -50%);
            border: none;
            background: transparent;
            padding: 0;
            cursor: pointer;
            outline-offset: 4px;
            transition: filter 250ms;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            animation: fadeInFromTop 1s ease-out forwards;
        }



        .button-82-front {
            width: 600px;
            height: 600px;
            display: flex;
            justify-content: center;
            flex-direction: column;
            position: relative;
            padding: 12px 27px;
            border-radius: 12px;
            font-size: 1.1rem;
            color: white;
            background-color: rgba(145, 79, 30, 0.9);
            background: url(start-button-0.svg);
            background-repeat: no-repeat;
            background-size: cover;
            will-change: transform;
            transform: translateY(-4px);
            font-family: 'Luckiest Guy', cursive, sans-serif;
            transition: transform 600ms cubic-bezier(.3, .7, .4, 1);
            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3));


        }


        .button-82-pushable:hover {
            filter: brightness(110%);
            -webkit-filter: brightness(110%);
        }

        .button-82-pushable:hover .button-82-front {
            transform: translateY(-6px);
            transition: transform 250ms cubic-bezier(.3, .7, .4, 1.5);
        }

        .button-82-pushable:active .button-82-front {
            transform: translateY(-2px);
            transition: transform 34ms;
        }

        .button-82-pushable:focus:not(:focus-visible) {
            outline: none;
        }

        /* Media Queries per la Responsività */
        @media (max-width: 1200px) {


            #textNextLevel {
                font-size: 2.6pc;
            }

            #question {

                font-size: 3.7pc;
                top: 40px;
                padding: 8px 16px;
            }


            .button-82-front {
                
               
                padding: 10px 20px;
            }
        }

        @media (max-width: 768px) {

            #textNextLevel {
                font-size: 2.0pc;
            }

            #question {
                font-size: 3pc;
                top: 30px;
                padding: 6px 12px;
            }


            .button-82-front {
        
                padding: 8px 16px;
            }

        }

        @media (max-width: 480px) {



            #textNextLevel {
                font-size: 40pt;
            }

            #question {

                font-size: 25pt;
                top: 30px;
                padding: 11px 8px;
            }

            #square {

                width: 20px;
                height: 20px;
            }


            .button-82-front {
                width: 500px;
                height: 500px;
                padding: 6px 12px;
            }


        }

        #gameArea {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            position: relative;
        }

        #startGameText {
            position: absolute;
            bottom: calc(50% + 50px);
            /* Posiziona il testo poco sopra il pulsante */
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffffff;
            font-size: 8vw;
            text-shadow: 0 30px 5px rgba(0, 0, 0, 0.3);
            z-index: 10;
            transition: top 1s ease-in-out;
            width: max-content;

        }




        @keyframes fadeInFromTop {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-50px);
            }

            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }


        .dot {

            background: rgb(184, 184, 184);
            position: absolute;
            pointer-events: none;
            transform: translate(-50%, -50%);
        }

        #blackScreen {

            position: fixed;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: top 1s ease-in-out;

        }

        #textNextLevel {
            display: none;
            color: #fff;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }
        }


        #messageContainer {

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        #messageContainer svg {
            animation: fadeIn 0.5s ease-in-out, bounce 0.5s ease-in-out;
        }

        #successMessage {
            display: block;
            width: 260px;
            height: 260px;
            background: url(tick.svg);
            background-repeat: no-repeat;
            background-size:cover;
            /* Lo SVG per il successo */
            animation: fadeIn 0.5s ease-in-out, bounce 0.5s ease-in-out;
        }

        #errorMessage {
            display: block;
            background: url(wrong.svg);
            width: 260px;
            height: 260px;
            background-repeat: no-repeat;
            background-size: cover;
            /* Lo SVG per l'errore */
            animation: fadeIn 0.5s ease-in-out, bounce 0.5s ease-in-out;
        }
    </style>
</head>

<body>
    <audio id="musicAudio" loop>
        <source src="audio/music-low.mp3" type="audio/mpeg">
        Il tuo browser non supporta l'audio HTML5.
    </audio>
    <audio id="throw">
        <source src="audio/throw.mp3" type="audio/mpeg">
        Il tuo browser non supporta l'audio HTML5.
    </audio>
    <audio id="splatter">
        <source src="audio/splatter.ogg" type="audio/ogg">
    </audio>
    <audio id="successAns">
        <source src="audio/success.mp3" type="audio/mpeg">
        Il tuo browser non supporta l'audio HTML5.
    </audio>
    <audio id="wrongAns">
        <source src="audio/wrong.mp3" type="audio/mpeg">
        Il tuo browser non supporta l'audio HTML5.
    </audio>
    <audio id="countdownTimer">
        <source src="audio/timer.wav" type="audio/wav">
        Il tuo browser non supporta l'audio HTML5.
    </audio>

    <div id="blackScreen">
        <div id="textNextLevel">Next level!</div>
    </div>

    <div id="messageContainer">
        <div id="successMessage" style="display: none;">
        
        </div>
        <div id="errorMessage" style="display: none;">
       
        </div>
    </div>

    <div id="gameArea">

        <!--<a href="https://www.flaticon.com/free-icons/snake" title="snake icons">Snake icons created by Freepik - Flaticon</a> snake attr-->
        <!--<div id="startGameText">START GAME</div>-->

        <div id="startButton" class="button-82-pushable" role="button">
            <div class="button-82-front text" id="startButton">
            </div>
        </div>


        <div id="question">SELECT <div id="square"></div> FROM PEOPLE;</div>


        <canvas id="gameCanvas"></canvas>
        <div id="countdown"></div>
    </div>

    <script>


        document.addEventListener("DOMContentLoaded", (event) => {
           
        });

        document.getElementById('startButton').addEventListener('click', function () {
            this.style.display = 'none';
            document.getElementById('musicAudio').play();
            startCountdown();
        });

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const countdownElement = document.getElementById('countdown');
        const questionElement = document.getElementById('question');
        const textNextLevel = document.getElementById('textNextLevel');
        const canvasWidth = canvas.width = window.innerWidth;
        const canvasHeight = canvas.height = window.innerHeight;
        let atLeastOneFruitIsCut = false;
        let currentFruitIndex = 0; // Per tracciare quale frutto viene lanciato


        let fruits = [];
        const fruitRadius = 65;
        const numFruits = 3;
        const maxHeight = 800;
        const gravity = 0.15;
        const initialSpeed = 13;
        const maxSpeed = 20;

        const fruitImages = [
            'frutta/anguria.png',
            'frutta/mela.png',
            'frutta/fragola.png',
        ];

        const leftCutedfruitImages = [
            'frutta/anguria-1.png',
            'frutta/mela-1.png',
            'frutta/fragola-1.png',
        ];

        const rightCutedfruitImages = [
            'frutta/anguria-2.png',
            'frutta/mela-2.png',
            'frutta/fragola-2.png',
        ];

        let questions = [
            {
                "question": "Anno inizio Prima Guerra Mondiale?",
                "answers": ["1914", "1800", "2012"],
                //"answers": ["d1-1", "d1-2", "d1-3"],
                "rigthAnswer": "1914",
                "userAnswer": ""

            },
            {
                "question": "Autore del quadro “Guernica”?",
                "answers": ["Baggio", "Picasso", "Van Gogh"],
                //"answers": ["d2-1", "d2-2", "d2-3"],
                "rigthAnswer": "Picasso",
                "userAnswer": ""
            },
            {
                "question": "Chi canta “Emozioni”?",
                "answers": ["Modugno", "Vasco", "Battisti"],
                //"answers": ["d3-1", "d3-2", "d3-3"],
                "rigthAnswer": "Battisti",
                "userAnswer": ""
            }
        ];

        let currentQuestionIndex = 0;

        function loadFruitImages(callback) {
            let loadedImages = 0;
            const images = [];
            fruitImages.forEach((url, index) => {
                const img = new Image();
                img.src = url;
                img.onload = () => {
                    loadedImages++;
                    images[index] = img;
                    if (loadedImages === fruitImages.length) {
                        callback(images);
                    }
                };
            });
        }

        function getFixedPositions() {
            const centerX = canvasWidth / 2;
            const spacing = canvasWidth / 3;

            return [
                { x: centerX - spacing, y: canvasHeight + fruitRadius },
                { x: centerX, y: canvasHeight + fruitRadius },
                { x: centerX + spacing, y: canvasHeight + fruitRadius },
            ];
        }

        function generateFruit(images) {
            fruits = [];
            const position = { x: canvasWidth / 2, y: canvasHeight + fruitRadius };
            const currentQuestion = questions[currentQuestionIndex];

            const img = images[currentFruitIndex];
            const answer = currentQuestion.answers[currentFruitIndex]; // Mostra una risposta per volta

            fruits.push({
                x: position.x,
                y: position.y,
                img: img,
                left_cut_img: leftCutedfruitImages[currentFruitIndex],
                rigth_cut_img: rightCutedfruitImages[currentFruitIndex],
                speed: initialSpeed,
                isRising: true,
                stopped: false,
                rotation: Math.random() * Math.PI * 2, // Rotazione casuale iniziale
                rotationSpeed: (Math.random() - 0.5) * 0.05,
                answer: answer
            });
        }

        function drawFruit(fruit) {
            const { img, x, y, rotation, answer } = fruit;

            // Imposta le proprietà dell'ombra
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 13;
            ctx.shadowOffsetY = 20;

            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.drawImage(img, -fruitRadius, -fruitRadius, fruitRadius * 2, fruitRadius * 2);
            ctx.restore();

            // Ripristina le proprietà dell'ombra
            ctx.shadowColor = 'transparent';  // Disabilita l'ombra per i testi
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;

            ctx.font = 'bold 30pt Luckiest Guy';
            const textWidth = ctx.measureText(answer).width;
            const textHeight = 30;

            // Sfondo del testo
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(x - textWidth / 2 - 8, y - textHeight - 8, textWidth + 30, textHeight + 30);

            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.strokeRect(x - textWidth / 2 - 8, y - textHeight - 8, textWidth + 30, textHeight + 30);

            ctx.fillStyle = '#fff';
            ctx.textAlign = 'center';
            ctx.fillText(answer, x, y + 7);

        }

        function drawFruitHalf(fruit) {
            const { img, x, y, rotation } = fruit;


            // Imposta le proprietà dell'ombra
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 13;
            ctx.shadowOffsetY = 20;
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.drawImage(img, -fruitRadius, -fruitRadius, fruitRadius * 2, fruitRadius * 2);
            ctx.restore();
        }

        function animateFruits() {
            fruits.forEach(fruit => {
                if (fruit.isLeft !== undefined) {
                    fruit.x += fruit.speedX;
                    fruit.y += fruit.speedY;
                    fruit.rotation += fruit.rotationSpeed;
                    fruit.speedY += gravity;
                } else if (!fruit.stopped) {
                    if (fruit.isRising) {
                        fruit.y -= fruit.speed;
                        fruit.speed -= gravity;

                        if (fruit.y < canvasHeight - maxHeight) {
                            fruit.isRising = false;
                            fruit.speed = 0;
                        }
                    } else {
                        fruit.y += fruit.speed;
                        fruit.speed += gravity;
                        if (fruit.speed > maxSpeed) {
                            fruit.speed = maxSpeed;
                        }
                        if (fruit.y > canvasHeight - fruitRadius) {
                            fruit.stopped = true;
                        }
                    }
                    fruit.rotation += fruit.rotationSpeed;
                }
            });
        }

        function drawFruits() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            fruits.forEach(fruit => {
                if (fruit.isLeft !== undefined) {
                    drawFruitHalf(fruit);
                } else {
                    drawFruit(fruit);
                }
            });
        }

        function showMessage(messageId, duration) {
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');

            if (messageId === 'success') {
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            } else if (messageId === 'error') {
                successMessage.style.display = 'none';
                errorMessage.style.display = 'block';
            }

            setTimeout(() => {
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
            }, duration);
        }

        function checkFruitCollision(x, y) {
            if (!atLeastOneFruitIsCut) {
                const fruit = fruits[0]; // C'è solo un frutto
                const dx = x - fruit.x;
                const dy = y - fruit.y;
                if (dx * dx + dy * dy < fruitRadius * fruitRadius) {
                    atLeastOneFruitIsCut = true;
                    const currentQuestion = questions[currentQuestionIndex];
                    if (fruit.answer === currentQuestion.rigthAnswer) {
                        
                        showMessage('success', 1500); // Mostra la spunta animata per 1,5 secondi
                        document.getElementById('successAns').play();
                    } else {
                        showMessage('error', 1500); // Mostra la X animata per 1,5 secondi
                        document.getElementById('wrongAns').play();
                    }
                    createFruitHalves(fruit, 0);
                    // proceedToNextQuestion(); // Vai subito alla prossima domanda
                }
            }
        }

        function createFruitHalves(fruit, index) {
            const leftImg = new Image();
            leftImg.src = fruit.left_cut_img;
            const rightImg = new Image();
            rightImg.src = fruit.rigth_cut_img;

            const halfWidth = fruitRadius;
            const halfHeight = fruitRadius;

            const leftHalf = {
                x: fruit.x + halfWidth / 2,
                y: fruit.y,
                img: leftImg,
                speedX: -2,
                speedY: -2,
                rotation: fruit.rotation,
                rotationSpeed: fruit.rotationSpeed,
                isLeft: true
            };
            fruits.push(leftHalf);

            const rightHalf = {
                x: fruit.x + halfWidth / 2,
                y: fruit.y,
                img: rightImg,
                speedX: 2,
                speedY: -2,
                rotation: fruit.rotation,
                rotationSpeed: fruit.rotationSpeed,
                isLeft: false
            };
            fruits.push(rightHalf);

            setTimeout(() => {
                fruits.splice(index, 1);
                document.getElementById('splatter').play();
            }, 50);
        }

        canvas.addEventListener('mousemove', function (e) {
            if (e.buttons === 1) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                checkFruitCollision(x, y);
            }
        });

        canvas.addEventListener('touchmove', function (e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.touches[0].clientX - rect.left;
            const y = e.touches[0].clientY - rect.top;
            checkFruitCollision(x, y);
        });



        function startGame() {
            if (currentQuestionIndex > 0 && currentFruitIndex == 0) {
                questionElement.style.display = 'none';
                setTimeout(() => {
                    questionElement.style.display = 'block';
                }, 1000);
            } else {
                questionElement.style.display = 'block';
            }

            questionElement.textContent = questions[currentQuestionIndex].question;

            setTimeout(() => {
                loadFruitImages(function (images) {
                    generateFruit(images); // Genera un frutto per volta
                    gameLoop();
                    document.getElementById('throw').play();
                });
            }, 5000);
        }


        function checkAllFruitsOutOfView() {
            return fruits.every(fruit => fruit.y > canvasHeight + fruitRadius);
        }

        function gameLoop() {
            animateFruits();
            drawFruits();

            if (checkAllFruitsOutOfView()) {
                console.log("sono prima di next question 2")
                proceedToNextQuestion();
            } else {
                requestAnimationFrame(gameLoop);
            }



        }

        function triggerBlackScreen(status, isFinish) {
            const blackScreen = document.getElementById('blackScreen');
            if (status === 'on') {
                if (isFinish) {
                    textNextLevel.style.display = 'block'
                }
                blackScreen.style.top = '0';
            } else if (status === 'off' && !isFinish) {
                blackScreen.style.top = '-100%';
            }
        }

        function proceedToNextQuestion() {


            if (currentFruitIndex < numFruits - 1 && !atLeastOneFruitIsCut) {
                currentFruitIndex++; // Passa al prossimo frutto (risposta)

                //atLeastOneFruitIsCut = false;
                startGame(); // Lancia il prossimo frutto della stessa domanda

            } else if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                currentFruitIndex = 0; // Resetta l'indice dei frutti

                atLeastOneFruitIsCut = false;
                startGame(); // Passa alla prossima domanda

            } else {
                
                triggerBlackScreen('on', true); // Mostra lo schermo nero alla fine di tutte le domande
            }
        }

        function startCountdown() {
            if (currentQuestionIndex === 0) { // Verifica se è la prima domanda
                countdownElement.style.display = 'flex';
                let countdownValue = 3;
                countdownElement.textContent = countdownValue;
                //document.getElementById('countdownTimer').play();
                const countdownInterval = setInterval(() => {
                    countdownValue--;
                    if (countdownValue > 0) {
                        countdownElement.textContent = countdownValue;
                    } else {
                        clearInterval(countdownInterval);
                        countdownElement.style.display = 'none';
                        startGame();
                    }
                }, 1000);
            } else {
                startGame(); // Se non è la prima domanda, inizia il gioco direttamente senza countdown
            }
        }

    </script>
</body>

</html>