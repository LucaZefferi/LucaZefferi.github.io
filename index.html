<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Invaders</title>
    <style>

        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            cursor: url('img/crosshair.png') 48 48, auto;
            background: linear-gradient(90deg, #01041F 0%, #082B33 100%);
            font-family: 'Luckiest Guy', cursive, sans-serif;
            user-select: none; /* Impedisce la selezione del testo */
            -webkit-user-select: none; /* Chrome/Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
        }


        .spaceship {
            width: 60px;
            height: 130px;
            width: 100px;
            height: 100px;
            background-color: white;
            position: absolute;
            display: none;
            bottom: 30px;
            background: url(img/alien.svg);
            background-repeat: no-repeat;
            background-size: contain;
            overflow: hidden;
            align-items: center;
            z-index: 10;
            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3)); /* Aggiunge un'ombra al testo per migliorare la visibilità */
        }

        .flame {
            position: absolute;
            bottom: 0px;
            bottom: -16px;
            left: 51%;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid rgba(255, 0, 0, 0.8);
            border-bottom: 20px solid transparent;
            transform: translateX(-50%) rotate(0deg);
            animation: flicker 0.2s infinite;

        }

        .flame:before {
            content: '';
            position: absolute;
            top: -17px;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 15px solid rgba(255, 165, 0, 0.8);
            border-bottom: 15px solid transparent;
            transform: translateX(-50%) rotate(0deg);
        }

        .flame:after {
            content: '';
            position: absolute;
            top: -18px;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 10px solid rgba(255, 255, 0, 0.8);
            border-bottom: 10px solid transparent;
            transform: translateX(-50%) rotate(0deg);
        }


        .bullet {
            width: 9px;
            height: 70px;
            background: #2afe00fa;
            position: absolute;
            bottom: 70px;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(49, 243, 10, 0.7);
        }


        #stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #01041F 0%, #082B33 100%);
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: #fff;
            width: 1px;
            height: 1px;
            border-radius: 50%;
        }

        .star:before {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            opacity: 0;
            animation: starTwinkle 2s infinite;
        }

        .shooting-star {
            position: absolute;
            width: 2px;
            height: 10px;
            background-color: #fff;
            opacity: 1;
            z-index: 1;
            transform: rotate(45deg);
            animation: shootingStarAnimation 0.5s linear forwards;
        }

        @keyframes starTwinkle {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(0.5);
                opacity: 1;
            }
            100% {
                transform: scale(0.5);
                opacity: 0;
            }
        }

        @keyframes shootingStarAnimation {
            0% {
                opacity: 1;
                transform: translateX(-200px) translateY(-200px) rotate(70deg);
            }
            100% {
                opacity: 0;
                transform: translateX(200px) translateY(-300px) rotate(70deg);
            }
        }


        #countdown {
            position: fixed; /* Cambia a fixed per essere sempre centrato rispetto alla finestra */
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%); /* Sposta l'elemento indietro di metà della sua larghezza e altezza */
            display: flex; /* Usa flex per centrare il testo al suo interno */
            align-items: center; /* Centra il testo verticalmente */
            justify-content: center; /* Centra il testo orizzontalmente */
            font-size: 150pt; /* Dimensione del testo del countdown */
            color: white; /* Colore del testo del countdown */

            opacity: 1; /* Imposta l'opacità iniziale */
            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3)); /* Aggiunge un'ombra al testo per migliorare la visibilità */
            animation: fadeInFromTop 2s ease-out forwards, zoomInOut 1s infinite; /* Aggiunge animazioni al countdown */
        }


        /* Randomized twinkle delays */
        .star:nth-child(1):before {
            animation-delay: 0.8s;
        }

        .star:nth-child(2):before {
            animation-delay: 1.2s;
        }

        .star:nth-child(3):before {
            animation-delay: 0.9s;
        }

        .star:nth-child(4):before {
            animation-delay: 1.4s;
        }

        .star:nth-child(5):before {
            animation-delay: 1.1s;
        }

        .star:nth-child(6):before {
            animation-delay: 0.7s;
        }

        /* Add more star:nth-child(n):before rules for additional stars */
        .star:nth-child(7):before {
            animation-delay: 1.3s;
        }

        .star:nth-child(8):before {
            animation-delay: 0.6s;
        }

        .star:nth-child(9):before {
            animation-delay: 1.5s;
        }

        .star:nth-child(10):before {
            animation-delay: 0.5s;
        }

        /* Continue adding star:nth-child(n):before rules for more delays */
        .star:nth-child(15):before {
            animation-delay: 0.8s;
        }

        .star:nth-child(16):before {
            animation-delay: 1.2s;
        }

        .star:nth-child(17):before {
            animation-delay: 0.9s;
        }

        .star:nth-child(18):before {
            animation-delay: 1.4s;
        }

        .star:nth-child(19):before {
            animation-delay: 1.1s;
        }

        .star:nth-child(20):before {
            animation-delay: 0.7s;
        }

        /* Add more star:nth-child(n):before rules for additional stars */
        .star:nth-child(11):before {
            animation-delay: 1.3s;
        }

        .star:nth-child(12):before {
            animation-delay: 0.6s;
        }

        .star:nth-child(13):before {
            animation-delay: 1.5s;
        }

        .star:nth-child(14):before {
            animation-delay: 0.5s;
        }


        .button-82-pushable {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border: none;
            background: transparent;
            padding: 0;
            cursor: pointer;
            outline-offset: 4px;
            transition: filter 250ms;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;

            /*animation: float 3s ease-in-out infinite;*/

        }


        .button-82-front {
            width: 600px;
            height: 600px;
            display: flex;
            justify-content: center;
            flex-direction: column;
            position: relative;
            padding: 12px 27px;
            border-radius: 12px;
            font-size: 1.1rem;
            color: white;
            background-color: rgba(145, 79, 30, 0.9);
            background: url("img/start-game.svg");
            background-repeat: no-repeat;
            background-size: cover;
            will-change: transform;
            transform: translateY(-4px);
            font-family: 'Luckiest Guy', cursive, sans-serif;
            transition: transform 600ms cubic-bezier(.3, .7, .4, 1);
            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3));


        }


        .button-82-pushable:hover {
            filter: brightness(110%);
            -webkit-filter: brightness(110%);
        }

        .button-82-pushable:hover .button-82-front {
            transform: translateY(-6px);
            transition: transform 250ms cubic-bezier(.3, .7, .4, 1.5);
        }

        .button-82-pushable:active .button-82-front {
            transform: translateY(-2px);
            transition: transform 34ms;
        }

        .button-82-pushable:focus:not(:focus-visible) {
            outline: none;
        }

        @keyframes fadeInFromTop {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes zoomInOut {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .explosion {
            position: absolute;
            width: 200px;
            height: 200px;
            background: url('img/explosion.svg');
            background-size: cover;
            background-repeat: no-repeat;
            pointer-events: none;

            animation: explode 1s ease-out forwards;
        }

        @keyframes explode {
            0% {
                opacity: 1;
                transform: scale(0);
            }

            35% {
                opacity: 0.8;
                transform: scale(1.7);
            }

            70% {
                opacity: 0.4;
                transform: scale(1.7);
            }

            100% {
                opacity: 0;
                transform: scale(1.7);
            }
        }


        #messageContainer {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        #messageContainer svg {
            animation: fadeIn 0.5s ease-in-out, bounce 0.5s ease-in-out;
        }

        #successMessage {
            display: block;
            height: 200px;
            width: 200px;
            background: url("img/tick.svg");
            background-repeat: no-repeat;
            background-size: cover;

            /* Lo SVG per il successo */
            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3));
            animation: fadeIn 0.5s ease-in-out, bounce 0.5s ease-in-out;
        }

        #errorMessage {
            display: block;
            background: url("img/wrong.svg");
            height: 200px;
            width: 200px;
            background-repeat: no-repeat;
            background-size: cover;
            /* Lo SVG per l'errore */

            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3));
            animation: fadeIn 0.5s ease-in-out, bounce 0.5s ease-in-out;
        }

        #question-container {
            display: none;

            margin-top: 20px;
            margin-left: 20px;
            margin-right: 20px;
            animation: fadeInFromTop 2s ease-out forwards;
            position: relative; /* Assicura che gli elementi all'interno siano posizionati relativamente */
            color: white;
            font-size: 24pt;
            text-align: center;
            justify-content: center; /* Centra il contenuto orizzontalmente */
            align-items: baseline;; /* Centra il contenuto verticalmente */
            font-family: 'Luckiest Guy', cursive, sans-serif;
        }


        .timer {

            font-size: 30pt;
            color: white;
            width: 60px;
            opacity: 1;
            filter: drop-shadow(0 30px 5px rgba(0, 0, 0, 0.3));
            animation: fadeInFromTop 1.9s ease-out forwards;
            transform: translateY(-50%);
            width: 50px;
            border: 4px solid #c20000;
            border-radius: 50%;
            text-align: center;
        }

        #question {

            font-size: 30pt;
            flex-grow: 1; /* Permette a #question di occupare tutto lo spazio rimanente */
            text-align: center; /* Assicura che il testo della domanda sia centrato */
            animation: fadeInFromTop 1.9s ease-out forwards;
        }


        @keyframes flicker {
            0% {
                opacity: 1;
                transform: translateX(-50%) scaleY(1);
            }
            20% {
                opacity: 0.8;
                transform: translateX(-50%) scaleY(1.1);
            }
            40% {
                opacity: 0.6;
                transform: translateX(-50%) scaleY(1);
            }
            60% {
                opacity: 0.7;
                transform: translateX(-50%) scaleY(0.9);
            }
            80% {
                opacity: 0.5;
                transform: translateX(-50%) scaleY(1.05);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scaleY(1);
            }
        }


        #planets-container {
            position: fixed;
            top: 30px;
            left: 0;
            width: 100%;
            height: 100%;
        }


        .planet {
            position: absolute;
            width: 180px;
            height: 180px;
            background-size: cover;
            background-repeat: no-repeat;
            text-shadow: 0 15px 15px rgba(0, 0, 0, 0.6);

        }

        .planet1 {
            background: url(img/p1.svg);
            left: 17%;
            margin-top: 110px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-size: cover;
            background-repeat: no-repeat;

        }

        .planet2 {
            background: url(img/p2.svg);
            left: 50%;
            margin-top: 110px;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .planet3 {
            background: url(img/p3.svg);
            right: 17%;
            margin-top: 110px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-size: cover;
            background-repeat: no-repeat;
        }


        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-25px);
            }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }


        #blackScreen {

            position: fixed;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: top 1s ease-in-out;

        }

        #textNextLevel {
            display: none;
            color: #fff;
            font-size: 30pt;
        }

        .index-container {
            display: flex;
            justify-items: center;
            justify-content: center;
            text-align: center;
        }




        @media (max-width: 768px) {


            .timer {

                font-size: 21pt;

            }

            #question {

                font-size: 21pt;
                top: 20px;
                padding: 16px 0;
            }
            .index {

                font-size: 21pt;

            }

            .index-container{


                font-size: 21pt;
            }

            #planets-container{

                top: 80px;
            }

            .planet {
                width: 150px;
                height: 150px;

            }
            .planet1 {
                left: 10%;
                margin-top:130px;
            }

            .planet2 {
                left: 50%;
                margin-top:130px;
            }

            .planet3 {
                right: 10%;
                margin-top:130px;
            }

            .explosion {

                width: 150px;
                height: 150px;

            }

            .button-82-front {
                width: 500px;
                height: 500px;
                padding: 6px 12px;
            }

            #question-container{
                font-size: 19pt;
            }

        }


        @media (max-width: 480px) {


            .timer {

                font-size: 22pt;

            }

            #question {

                font-size: 22pt;
                top: 20px;
                padding: 16px 0;
            }
            .index {

                font-size: 20pt;

            }

            .index-container{

                position: absolute;
                top: 0;
                left: 85%;
                font-size: 22pt;
            }

            #planets-container{

                top: 80px;
            }

            .planet {
                width: 100px;
                height: 100px;

            }
            .planet1 {
                left: 2%;
                margin-top:130px;
            }

            .planet2 {
                left: 50%;
                margin-top:130px;
            }

            .planet3 {
                right: 2%;
                margin-top:130px;
            }

            .explosion {

                width: 150px;
                height: 150px;

            }

            .button-82-front {
                width: 400px;
                height: 400px;
                padding: 6px 12px;
            }

            #question-container{
                font-size: 18pt;
            }

        }


    </style>
</head>

<body>


<audio id="wrong-audio">
    <source src="audio/wrong.mp3" type="audio/mpeg">
</audio>

<audio id="success-audio">
    <source src="audio/success.mp3" type="audio/mpeg">
</audio>

<audio id="music" loop>
    <source src="audio/music.mp3" type="audio/mpeg">
</audio>

<audio id="laser">
    <source src="audio/laser.mp3" type="audio/mpeg">
</audio>

<div id="blackScreen">
    <div id="textNextLevel">Next level!</div>
</div>

<div class="button-82-pushable" role="button">
    <div class="button-82-front text" id="startButton">
    </div>
</div>

<div id="messageContainer">
    <div id="successMessage" style="display: none;">

    </div>
    <div id="errorMessage" style="display: none;">

    </div>
</div>

<div id="question-container">
    <div class="timer" id="timer">15</div>
    <div id="question"></div>
    <div class="index-container" style="border: 0px">
        <div class="index" id="index">1</div>
        /25
    </div>  <!-- invisible char -->
    <div id="planets-container">
        <div class="planet planet1"></div>
        <div class="planet planet2"></div>
        <div class="planet planet3"></div>
    </div>
</div>
<div id="stars">
    <canvas id="miCanvas"></canvas>
</div>
<div id="countdown"></div>


<div class="spaceship" id="player">
    <div class="flame"></div> <!-- Aggiungi questo elemento per la fiamma -->
</div>


<script>
    const canvas = document.getElementById("miCanvas");
    const ctx = canvas.getContext("2d");
    var isStarted = false;
    var canShoot = false;
    const countdownElement = document.getElementById('countdown');
    const timerElement = document.getElementById('timer');
    var currentQuestionIndex = 0;
    const indexElement = document.getElementById('index');
    const spaceship = document.getElementById('player');

    const planetsContainer = document.getElementById('planets-container');
    const questionContainer = document.getElementById('question-container');
    const questionElement = document.getElementById('question');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let questions = [

        {
            "question": "If I ____ the truth, I would have told you earlier.",
            "answers": ["had known", "knew", "know"],
            //"answers": ["d2-1", "d2-2", "d2-3"],
            "rigthAnswer": "had known",
            "userAnswer": ""
        },
        {
            "question": "He suggested that she ____ a doctor as soon as possible.",
            "answers": ["sees", "see", "saw"],
            //"answers": ["d1-1", "d1-2", "d1-3"],
            "rigthAnswer": "see",
            "userAnswer": ""

        },
        {
            "question": "By the time we arrived, the concert ____.",
            "answers": ["had already started", "started", "was starting"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "had already started",
            "userAnswer": ""
        },
        {
            "question": "It’s high time you ____ making excuses and started working.",
            "answers": ["stop", "stopped", "had stopped"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "stopped",
            "userAnswer": ""
        },
        {
            "question": "I wish I ____ the decision to move abroad earlier.",
            "answers": ["made", "had made", "would make"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "had made",
            "userAnswer": ""
        },
        {
            "question": "She said she ____ to finish the project by next week.",
            "answers": ["will try", "would try", "tried"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "would try",
            "userAnswer": ""
        },
        {
            "question": "____ I known about the meeting, I would have attended.",
            "answers": ["If", "Had", "Were"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "Had",
            "userAnswer": ""
        },
        {
            "question": "I don’t remember ____ her at the party.",
            "answers": ["seeing", "see", "to see"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "seeing",
            "userAnswer": ""
        },
        {
            "question": "They would have arrived on time if they ____ the right train.",
            "answers": ["catch", "caught", "had caught"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "had caught",
            "userAnswer": ""
        },
        {
            "question": "The manager demanded that the report ____ immediately.",
            "answers": ["is submitted", "was submitted", "be submitted"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "be submitted",
            "userAnswer": ""
        },
        {
            "question": "By the time you arrive, I ____ dinner",
            "answers": ["will have finished", "am finishing", "finished"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "will have finished",
            "userAnswer": ""
        },
        {
            "question": "She acts as if she ____ everything.",
            "answers": ["knows", "knew", "had known"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "knew",
            "userAnswer": ""
        },
        {
            "question": "I was hoping you ____ come to the party last night.",
            "answers": ["would", "will", "had"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "would",
            "userAnswer": ""
        },
        {
            "question": "If they ____ harder, they could have won the game.",
            "answers": ["try", "tried", "had tried"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "had tried",
            "userAnswer": ""
        },
        {
            "question": "I’ll give you the book after I ____ it.",
            "answers": ["finish", "finished", "have finished"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "have finished",
            "userAnswer": ""
        },
        {
            "question": "I’d rather you ____ about this to anyone.",
            "answers": ["not talk", "didn’t talk", "don’t talk"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "didn’t talk",
            "userAnswer": ""
        },
        {
            "question": "He has been working here since he ____ school.",
            "answers": ["left", "leaves", "was leaving"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "left",
            "userAnswer": ""
        },
        {
            "question": "If I ____ more money, I would travel the world.",
            "answers": ["have", "had", "would have"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "had",
            "userAnswer": ""
        },
        {
            "question": "I’ll let you know as soon as I ____ more information.",
            "answers": ["will have", "have", "had"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "have",
            "userAnswer": ""
        },
        {
            "question": "The lawyer insisted that his client ____ innocent.",
            "answers": ["was", "be", "is"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "be",
            "userAnswer": ""
        },
        {
            "question": "She wouldn’t have missed the train if she ____ earlier.",
            "answers": ["had left", "would leave", "leaves"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "had left",
            "userAnswer": ""
        },
        {
            "question": "Had it not been for the traffic, we ____ on time.",
            "answers": ["would arrive", "will arrive", "would have arrived"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "would have arrived",
            "userAnswer": ""
        },
        {
            "question": "I regret ____ him my secret.",
            "answers": ["telling", "to tell", "told"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "telling",
            "userAnswer": ""
        },
        {
            "question": "You’d better ____ late again if you want to keep your job.",
            "answers": ["not be", "be not", "not to be"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "not be",
            "userAnswer": ""
        },
        {
            "question": "I’ll call you after I ____ from the meeting.",
            "answers": ["will leave", "leave", "left"],
            //"answers": ["d3-1", "d3-2", "d3-3"],
            "rigthAnswer": "leave",
            "userAnswer": ""
        },
    ];

    function isMobileDevice() {
        return /Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
    }

    function triggerBlackScreen(status, isFinish) {
        const blackScreen = document.getElementById('blackScreen');
        if (status === 'on') {
            if (isFinish) {
                textNextLevel.style.display = 'block'
            }
            blackScreen.style.top = '0';
        } else if (status === 'off' && !isFinish) {
            blackScreen.style.top = '-100%';
        }
    }

    let timerInterval; // Sposta la dichiarazione fuori da startTimer per avere accesso globale

    function displayQuestion() {


        if (currentQuestionIndex < questions.length) {
            // Reset the timer when a new question is displayed
            if(window.outerWidth > 468){
                questionContainer.style.display = 'flex';
            }else{
                questionContainer.style.display = 'block';
            }

            stopTimer(); // Stop any running timer

            questionElement.textContent = questions[currentQuestionIndex].question;
            indexElement.textContent = currentQuestionIndex + 1

            const planets = document.querySelectorAll('.planet');
            planets.forEach((planet, index) => {

                planet.textContent = questions[currentQuestionIndex].answers[index];

            });

            resetTimer()
            setTimeout(() => {
                startTimer(); // Start the new timer
                planetsContainer.classList.add('animate-float');
            }, 1700);

            canShoot = true;
        } else {

            triggerBlackScreen('on', true)
        }
    }

    function startTimer() {
        console.log("start timer");
        // Reset the timer value to 10
        let timerValue = 15;
        timerElement.textContent = timerValue;

        // Clear any previous interval
        clearInterval(timerInterval);

        // Start a new countdown
        timerInterval = setInterval(() => {
            timerValue--;
            timerElement.textContent = timerValue > 0 ? timerValue : '0';
            if (timerValue <= 0) {
                clearInterval(timerInterval);

                canShoot = false;
                questionContainer.style.display = 'none';
                planetsContainer.classList.remove('animate-float');

                currentQuestionIndex++;


                setTimeout(() => {

                    displayQuestion();
                }, 2000);
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    function resetTimer() {
        timerElement.textContent = 15;
    }


    document.addEventListener("DOMContentLoaded", function () {
        const starCount = 45;
        const shootingStarInterval = 800;
        const startButton = document.getElementById('startButton');
        generateStars();


        startButton.addEventListener('click', startGame);

        function startGame() {
            // Nascondi lo schermo iniziale
            startButton.style.display = "none";
            isStarted = true;


            startCountdown();

            // Abilita la possibilità di sparare dopo 5 secondi
            setTimeout(() => {
                canShoot = true;
            }, 5000);

            // Avvia l'animazione delle stelle e il movimento della navicella
            movePlayer();
            moveBullets();


        }


        function startCountdown() {
            // Mostra il countdown e inizializza il valore
            document.getElementById("music").play();


            countdownElement.style.display = 'flex';
            let countdownValue = 3;
            countdownElement.textContent = countdownValue;

            // Aggiorna il countdown ogni secondo
            const countdownInterval = setInterval(() => {
                countdownValue--;
                countdownElement.textContent = countdownValue > 0 ? countdownValue : '';
                if (countdownValue <= 0) {
                    clearInterval(countdownInterval);
                    countdownElement.style.display = 'none'; // Nasconde il countdown dopo il completamento

                }
            }, 1000);


            setTimeout(() => {
                //showPlanets();
                spaceship.style.display = 'flex'
                displayQuestion();
            }, "4000");

        }


        function showPlanets() {

            const planets = document.querySelectorAll('.planet');
            planets.forEach(planet => {

                planet.style.display = 'flex';
            });
        }

        /*
        function hidePlanets() {
                const planets = document.querySelectorAll('.planet');
                planets.forEach(planet => {
                    planet.style.zIndex = '-99999';
                    planet.style.display = 'none';
                });
        }
        */


        function createStar() {
            const star = document.createElement("div");
            star.className = "star";
            star.style.top = `${Math.random() * 100}%`;
            star.style.left = `${Math.random() * 100}%`;
            document.getElementById("stars").appendChild(star);
        }


        function generateStars() {
            for (let i = 0; i < starCount; i++) {
                createStar();
            }
        }


// Controlla se non è un dispositivo mobile
        if (!isMobileDevice()) {
            function createShootingStar() {
                const shootingStar = document.createElement("div");
                shootingStar.className = "shooting-star";
                shootingStar.style.top = `${Math.random() * 100}%`;
                shootingStar.style.left = `${Math.random() * 100}%`;
                document.body.appendChild(shootingStar);
                setTimeout(() => {
                    document.body.removeChild(shootingStar);
                }, 3000);
            }

            function randomizeShootingStarInterval() {
                const interval = Math.random() * shootingStarInterval;
                setTimeout(function () {
                    createShootingStar();
                    randomizeShootingStarInterval();
                }, interval);
            }

            randomizeShootingStarInterval();
        }


        generateStars();


        let playerX = canvas.width / 2 - 100;

        function drawPlayer(mouseX) {
            const centerX = window.innerWidth / 2; // Centro dello schermo
            const maxRotation = 15; // Angolo massimo di inclinazione in gradi

            // Calcola la percentuale di quanto è lontano il mouse dal centro
            const distanceFromCenter = (mouseX - centerX) / centerX;

            // Calcola l'angolo di rotazione basato sulla distanza dal centro
            const rotation = maxRotation * distanceFromCenter;

            // Applica la rotazione e la posizione alla navicella
            spaceship.style.transform = `translateX(${playerX}px) rotate(${rotation}deg)`;


        }

        function resetPlayer() {
            // Riporta la navicella in posizione dritta
            spaceship.style.transform = `translateX(${playerX}px) rotate(0deg)`;
        }

        // Modifica per il movimento del mouse
        document.addEventListener('mousemove', function (e) {
            playerX = e.clientX - spaceship.offsetWidth / 2;
            drawPlayer(e.clientX);
        });

        function movePlayer() {
            drawPlayer();
            requestAnimationFrame(movePlayer);
        }

        window.addEventListener("resize", () => {
            console.log("res")
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        let bullets = [];

        let lastShotTime = 0; // Tempo dell'ultimo sparo
        let shotCount = 0;    // Conteggio dei proiettili sparati nel ciclo corrente
        const maxShots = 1;   // Numero massimo di proiettili per intervallo
        const interval = 1000; // Intervallo di tempo in millisecondi (2 secondi)

        document.addEventListener('click', function (e) {
            const currentTime = Date.now();

            if (isStarted && canShoot) {
                // Se è passato l'intervallo di tempo definito o non è stato sparato nulla
                if (currentTime - lastShotTime > interval) {
                    lastShotTime = currentTime; // Aggiorna il tempo dell'ultimo sparo
                    shotCount = 0; // Resetta il conteggio dei proiettili
                }

                // Permette di sparare solo se il numero massimo di proiettili non è stato raggiunto
                if (shotCount < maxShots) {
                    createBullet();
                    shotCount++; // Incrementa il conteggio dei proiettili
                }
            }
        });

        function createBullet() {
            let bullet = document.createElement('div');
            bullet.classList.add('bullet');
            bullet.style.left = playerX + spaceship.offsetWidth / 2 - 2.5 + 'px';
            bullet.style.bottom = '70px';
            document.body.appendChild(bullet);
            bullets.push(bullet);
            document.getElementById("laser").play();
        }


        function moveBullets() {
            bullets.forEach((bullet, index) => {
                bullet.style.bottom = parseInt(bullet.style.bottom) + 25 + 'px';
                console.log("sparooooooooo")
                if (parseInt(bullet.style.bottom) > window.innerHeight) {
                    bullet.remove();
                    bullets.splice(index, 1);
                }

                const planets = document.querySelectorAll('.planet');
                planets.forEach((planet, planetIndex) => {
                    if (isCollide(bullet, planet)) {
                        bullet.remove();
                        bullets.splice(index, 1);


                        if (canShoot) {
                            canShoot = false;

                            /*
                            if (planet.textContent === questions[currentQuestionIndex].rigthAnswer) {
                                document.getElementById("success-audio").play();
                                showMessage('success', 1500, planet); // Mostra la spunta animata per 1,5 secondi

                                //document.getElementById('successAns').play();
                            } else {
                                document.getElementById("wrong-audio").play();
                                showMessage('error', 1500, planet); // Mostra la X animata per 1,5 secondi

                                //document.getElementById('wrongAns').play();
                            }
                            */

                            stopTimer()
                            createExplosion(planet);
                            currentQuestionIndex++;

                        }


                        planet.style.display = 'none';


                    }
                });

            });

            requestAnimationFrame(moveBullets);

        }

        function showMessage(messageId, duration, targetElement) {
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const rect = targetElement.getBoundingClientRect();
            const messageContainer = document.getElementById('messageContainer');

            messageContainer.style.position = 'absolute';
            messageContainer.style.left = `${rect.left + targetElement.offsetWidth / 2}px`;
            messageContainer.style.top = `${rect.bottom - targetElement.offsetHeight / 3 - 30}px`; // Position below the planet

            if (messageId === 'success') {
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            } else if (messageId === 'error') {
                successMessage.style.display = 'none';
                errorMessage.style.display = 'block';
            }

            setTimeout(() => {
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
            }, duration);
        }


        function createExplosion(targetElement) {
            const explosion = document.createElement('div');
            explosion.classList.add('explosion');
            const rect = targetElement.getBoundingClientRect();
            explosion.style.left = rect.left - 30 + 'px';
            explosion.style.top = rect.top - 30 + 'px';
            document.body.appendChild(explosion);
            // Rimuovi l'esplosione dopo l'animazione
            explosion.addEventListener('animationend', () => {
                explosion.remove();
            });


            setTimeout(() => {
                planetsContainer.classList.remove('animate-float');
                questionContainer.style.display = 'none';
                showPlanets();
                //hidePlanets();
            }, "1500");

            setTimeout(() => {


                displayQuestion();
                //showPlanets();
            }, "4000");

        }


        function isCollide(a, b) {
            const aRect = a.getBoundingClientRect();
            const bRect = b.getBoundingClientRect();

            return !(
                aRect.top > bRect.bottom ||
                aRect.bottom < bRect.top ||
                aRect.right < bRect.left ||
                aRect.left > bRect.right
            );
        }
    });

</script>
</body>

</html>